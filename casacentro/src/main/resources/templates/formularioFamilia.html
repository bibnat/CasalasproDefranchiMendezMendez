<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Editar Familia</title>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            margin: 30px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .form-section {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background-color: #fff;
        }
        th, td {
            padding: 10px 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 200px;
            padding: 6px 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #2980b9;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1f6391;
        }
        a {
            color: #2980b9;
            text-decoration: none;
            margin-left: 10px;
        }
        a:hover {
            text-decoration: underline;
        }
        .mensaje { color: green; font-weight: bold; margin-bottom: 10px; }
        .error { color: red; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<h2>Editar Familia</h2>
<div th:if="${mensaje}" class="mensaje" th:text="${mensaje}"></div>

<!-- Formulario principal de edici√≥n de familia -->
<form th:action="@{/familias}" th:object="${familia}" method="post" id="formulario-principal">
    <input type="hidden" th:field="*{id}" />
    <div class="form-section">
        <label>Nombre de la familia:</label>
        <input type="text" th:field="*{nombre}" required /><br/>
		
		<label>Fecha de alta:</label>
		<input type="date" name="fechaRegistro"
		       th:value="${#temporals.format(familia.fechaRegistro, 'yyyy-MM-dd')}" readonly />
		
        <br/><br/>
        <button type="submit">üíæ Guardar cambios</button>
        <a th:href="@{/familias}">üîô Volver al listado</a>
    </div>
</form>

<!-- Listado de integrantes con opci√≥n de edici√≥n uno por uno -->
<div class="form-section">
    <h3>Integrantes de la familia</h3>
    <table>
        <thead>
            <tr>
                <th>DNI</th><th>Apellido</th><th>Nombre</th><th>Fecha nacimiento</th><th>Ocupaci√≥n</th><th>Acciones</th>
            </tr>
        </thead>
		<tbody>
		<tr th:each="a : ${familia.integrantes}" th:if="${!a.eliminado}">
		    <td>
		        <input type="number" name="asistidoDni" th:value="${a.dni}"
		               th:disabled="${editarId != a.id}" form="formulario-principal" required />
		    </td>
		    <td>
		        <input type="text" name="asistidoApellido" th:value="${a.apellido}"
		               th:disabled="${editarId != a.id}" form="formulario-principal" required />
		    </td>
		    <td>
		        <input type="text" name="asistidoNombre" th:value="${a.nombre}"
		               th:disabled="${editarId != a.id}" form="formulario-principal" required />
		    </td>
		    <td>
		        <input type="date" name="asistidoFechaNacimiento"
		               th:value="${a.fechaNacimiento}" th:disabled="${editarId != a.id}"
		               form="formulario-principal" required />
		    </td>
		    <td>
		        <select name="asistidoOcupacion" th:disabled="${editarId != a.id}" form="formulario-principal" required>
		            <option value="">Seleccione</option>
		            <option value="desempleado" th:selected="${a.ocupacion == 'desempleado'}">Desempleado</option>
		            <option value="empleado" th:selected="${a.ocupacion == 'empleado'}">Empleado</option>
		            <option value="estudiante" th:selected="${a.ocupacion == 'estudiante'}">Estudiante</option>
		            <option value="ama de casa" th:selected="${a.ocupacion == 'ama de casa'}">Ama de casa</option>
		            <option value="otro" th:selected="${a.ocupacion == 'otro'}">Otro</option>
		        </select>
		    </td>
		    <td>
		         <!-- Bot√≥n para habilitar la edici√≥n de un integrante -->
		        <form th:action="@{'/familias/editar/' + ${familia.id}}" method="get" style="display:inline;">
		            <input type="hidden" name="editarId" th:value="${a.id}" />
		            <button type="submit">‚úèÔ∏è</button>
		        </form>
		        <!-- Bot√≥n para eliminar integrante -->
		        <form th:action="@{/familias/eliminarAsistido}" method="post" style="display:inline;">
		            <input type="hidden" name="asistidoId" th:value="${a.id}" />
		            <input type="hidden" name="familiaId" th:value="${familia.id}" />
		            <button type="submit" onclick="return confirm('¬øEliminar integrante?')">üóëÔ∏è</button>
		        </form>
		    </td>
		</tr>
		</tbody>


    </table>
</div>

<!-- Secci√≥n para agregar un nuevo integrante -->
<div class="form-section" th:if="${familia.id != null}">
    <h3>Agregar nuevo integrante</h3>
    <form th:action="@{/familias/agregarAsistido}" th:object="${nuevoAsistido}" method="post">
        <input type="hidden" name="familiaId" th:value="${familia.id}" />
        <label>DNI:</label><input type="number" th:field="*{dni}" required /><br/>
        <label>Apellido:</label><input type="text" th:field="*{apellido}" required /><br/>
        <label>Nombre:</label><input type="text" th:field="*{nombre}" required /><br/>
        <label>Fecha de nacimiento:</label><input type="date" th:field="*{fechaNacimiento}" required /><br/>
        <label>Ocupaci√≥n:</label>
        <select th:field="*{ocupacion}" required>
            <option value="">Seleccione</option>
            <option value="desempleado">Desempleado</option>
            <option value="empleado">Empleado</option>
            <option value="estudiante">Estudiante</option>
            <option value="ama de casa">Ama de casa</option>
            <option value="otro">Otro</option>
        </select><br/>
        <button type="submit">‚ûï Agregar integrante</button>
    </form>
</div>

</body>
</html>
